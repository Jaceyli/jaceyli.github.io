<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="baidu-site-verification" content="E91H9LxOVM" />
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          MapReduce II - Jingxuan&#39;s blog
        
    </title>

    <link rel="canonical" href="https://jingxuan.li/2018/03/20/COMP9313-Week-3-MapReduce-II/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116294246-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-116294246-1');
    </script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#COMP9313" title="COMP9313">COMP9313</a>
                            
                              <a class="tag" href="/tags/#Big Data" title="Big Data">Big Data</a>
                            
                        </div>
                        <h1>MapReduce II</h1>
                        <h2 class="subheading">COMP9313 Week 3 @18S1 UNSW</h2>
                        <span class="meta">
                            Posted by Jingxuan on
                            2018-03-20
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jingxuan&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <style>
img{
    max-width: 80%!important
}
</style>
<blockquote>
<p>Abstract:</p>
<ul>
<li>Design Pattern 1: In-mapper Combining</li>
<li>Design Pattern 2: Pairs vs Stripes</li>
<li>Design Pattern 3: Order Inversion</li>
</ul>
</blockquote>
<p><strong>Combiner Function</strong></p>
<ul>
<li><strong>To minimize the data transferred between map and reduce tasks</strong></li>
<li>Combiner function is <strong>run on the map output</strong></li>
<li>Both input and output data types must be <strong>consistent with</strong>（保持一致） the output of mapper (or input of reducer)</li>
<li>But Hadoop do not guarantee how many times it will call combiner function for a particular map output record
<ul>
<li>It is just optimization</li>
<li>The number of calling (even zero) does not affect the output of<br>
Reducers</li>
</ul>
</li>
<li><font color="#FF6347">Applicable on problems that are commutative and associative</font>
<ul>
<li>Commutative（交换率）: max(a, b) = max(b, a)</li>
<li>Associative（结合律）: max (max(a, b), c) = max(a, max(b, c))</li>
</ul>
</li>
</ul>
<h1 id="design-pattern-1-in-mapper-combining">Design Pattern 1: In-mapper Combining</h1>
<hr>
<h2 id="importance-of-local-aggregation">Importance of Local Aggregation</h2>
<ul>
<li>Ideal scaling characteristics:
<ul>
<li>Twice the data, twice the running time</li>
<li>Twice the resources, half the running time</li>
</ul>
</li>
<li>Why can’t we achieve this?
<ul>
<li><strong>Data synchronization requires communication</strong></li>
<li><strong>Communication kills performance</strong></li>
</ul>
</li>
<li>How to avoid communication?
<ul>
<li>Reduce intermediate data via <strong>local aggregation</strong></li>
<li>in-mapper combining can help!</li>
</ul>
</li>
</ul>
<h2 id="example-1-wordcount">Example 1: WordCount</h2>
<p>WordCount Baseline:<br>
<img src="1.png" alt=""></p>
<h3 id="version-1">Version 1</h3>
<p><img src="2.png" alt=""></p>
<p>这种方法，每执行一次map就new一个Hashmap，将一个document下所有term t都sum到 H{t} 中，然后EMIT(term t, count H{t})。</p>
<p><strong>This mapper use more space to reduce time cost.</strong></p>
<ul>
<li>Are combiners still needed?<br>
Yes, one hashmap is applied to one document, and it need to aggregate.</li>
</ul>
<p>但是由于在combiner中aggregate效率还是不高，所以我们继续改进为in-mapper combining</p>
<h3 id="version-2-in-mapper-combining">Version 2: in-mapper combining</h3>
<p><img src="3.png" alt=""></p>
<p>这种方法，先new一个总的Hashmap，通过不断的读入documents来不断的将term t的数量sum到这个总的Hashmap的H{t}中。</p>
<h2 id="example-2-computing-the-mean">Example 2: Computing the Mean</h2>
<h3 id="version-1">Version 1</h3>
<p><img src="4.png" alt=""></p>
<p><font color="#FF6347"><strong>! WRONG</strong></font></p>
<ul>
<li>Why can’t we use reducer as combiner?<br>
Mean(1, 2, 3, 4, 5) != Mean(Mean(1, 2), Mean(3, 4, 5)) <strong>不满于结合律</strong></li>
</ul>
<h3 id="version-2">Version 2</h3>
<p><img src="6.png" alt=""></p>
<p><font color="#FF6347"><strong>! WRONG</strong></font></p>
<ul>
<li>Why doesn’t this work?<br>
Combiners must have the same input and output type, <strong>consistent with the input of reducers (output of mappers)</strong></li>
</ul>
<h3 id="version-3">Version 3</h3>
<p><img src="5.png" alt=""></p>
<p>这个方法是对的，但是有combiner还是不那么高效，可以将其转化为更高效的in-mapper combining</p>
<h3 id="version-4-in-mapper-combining">Version 4 : in-mapper combining</h3>
<p><img src="7.png" alt=""></p>
<h2 id="how-to-implement-in-mapper-combiner-in-mapreduce">How to Implement In-mapper Combiner in MapReduce?</h2>
<ul>
<li>Lifecycle: setup -&gt; map -&gt; cleanup
<ul>
<li>setup(): called once at the beginning of the task</li>
<li>map(): do the map</li>
<li>cleanup(): called once at the end of the task.</li>
<li>We do not invoke these functions</li>
</ul>
</li>
<li>In-mapper Combining:
<ul>
<li>Use setup() to <strong>initialize the state preserving data structure</strong></li>
<li>Use clearnup() to <strong>emit the final key-value pairs</strong></li>
</ul>
</li>
</ul>
<h2 id="summary">Summary</h2>
<ul>
<li>“In-mapper combining”
<ul>
<li>Fold the functionality of the combiner into the mapper by preserving state across multiple map calls</li>
</ul>
</li>
<li>Advantages
<ul>
<li>Speed</li>
<li>faster than actual combiners(因为in-mapper combining是完全在memory中进行的, no I/O cost)</li>
</ul>
</li>
<li>Disadvantages
<ul>
<li>Explicit memory management required（need for space, 数据量过大的时候，还是需要用combiner）</li>
<li>Potential for order-dependent bugs</li>
</ul>
</li>
</ul>
<h1 id="design-pattern-2-pairs-vs-stripes">Design Pattern 2: Pairs vs Stripes</h1>
<hr>
<h2 id="term-co-occurrence-matrix">Term co-occurrence matrix</h2>
<ul>
<li>Term co-occurrence matrix for a text collection
<ul>
<li>M = N x N matrix (N = vocabulary size)</li>
<li>Mij: number of times i and j co-occur in some context (for concreteness, let’s say context = sentence)</li>
<li>specific instance of a large counting problem
<ul>
<li>A large event space (number of terms)</li>
<li>A large number of observations (the collection itself)</li>
<li>Goal: keep track of interesting statistics about the events</li>
</ul>
</li>
</ul>
</li>
<li>Basic approach
<ul>
<li>Mappers generate partial counts</li>
<li>Reducers aggregate partial counts</li>
</ul>
</li>
</ul>
<h2 id="pairs">Pairs</h2>
<ul>
<li>Each mapper takes a sentence
<ul>
<li>Generate all co-occurring term pairs</li>
<li>For all pairs, emit (a, b) → count</li>
</ul>
</li>
<li>Reducers sum up counts associated with these pairs</li>
<li>Use combiners!</li>
</ul>
<p><img src="8.png" alt=""></p>
<ul>
<li>
<p>Advantages</p>
<ul>
<li>Easy to implement, easy to understand</li>
</ul>
</li>
<li>
<p>Disadvantages</p>
<ul>
<li>Lots of pairs to sort and shuffle around (upper bound?)</li>
<li>Not many opportunities for combiners to work</li>
</ul>
</li>
</ul>
<h2 id="stripes">Stripes</h2>
<ul>
<li>
<p>Idea: group together pairs into an associative array<br>
(a, b) → 1 ,    (a, c) → 2 ,   (a, d) → 5 ,  (a, f) → 2<br>
generate: a → { b: 1, c: 2, d: 5, e: 3, f: 2 } (a, e) → 3</p>
</li>
<li>
<p>Each mapper takes a sentence:</p>
<ul>
<li>Generate all co-occurring term pairs</li>
<li>For each term, emit a → { b: countb, c: countc, d: countd … }</li>
</ul>
</li>
<li>
<p>Reducers perform element-wise sum of associative arrays<br>
<img src="9.png" alt=""></p>
</li>
</ul>
<p><img src="10.png" alt=""></p>
<ul>
<li>
<p>Advantages</p>
<ul>
<li>Far less sorting and shuffling of key-value pairs</li>
<li>Can make better use of combiners</li>
</ul>
</li>
<li>
<p>Disadvantages</p>
<ul>
<li>More difficult to implement</li>
<li>Underlying object more heavyweight</li>
<li>Fundamental limitation in terms of size of event space (Stripe H may be huge)</li>
</ul>
</li>
</ul>
<h2 id="pairs-vs-stripes">Pairs vs. Stripes</h2>
<p><img src="11.png" alt=""></p>
<ul>
<li>
<p>The pairs approach</p>
<ul>
<li>Keep track of <strong>each term co-occurrence separately</strong></li>
<li>Generates <strong>a large number of key-value pairs</strong> (also intermediate)</li>
<li>The benefit from combiners is limited, as it is less likely for a mapper to process multiple occurrences of a word</li>
</ul>
</li>
<li>
<p>The stripe approach</p>
<ul>
<li>Keep track of <strong>all terms that co-occur with the same term</strong></li>
<li>Generates <strong>fewer and shorted intermediate keys</strong></li>
<li>The framework has less sorting to do</li>
<li>Greatly benefits from combiners, as the key space is the vocabulary</li>
<li><strong>More efficient, but may suffer from memory problem</strong></li>
</ul>
</li>
<li>
<p>These two design patterns are broadly useful and frequently observed<br>
in a variety of applications</p>
<ul>
<li>Text processing, data mining, and bioinformatics</li>
</ul>
</li>
</ul>
<h2 id="how-to-implement-pairs-and-stripes-in-mapreduce">How to Implement “Pairs” and “Stripes” in MapReduce?</h2>
<ul>
<li>Process of turning structured objects into a byte stream for <strong>transmission over a network</strong> or for <strong>writing to persistent storage</strong></li>
<li>Deserialization is the reverse process of serialization</li>
<li>Requirements
<ul>
<li>Compact: to make efficient use of storage space</li>
<li>Fast: the overhead in reading and writing of data is minimal</li>
<li>Extensible: we can transparently read data written in an older format</li>
<li>Interoperable（能共同操作的）: we can read or write persistent data using different language</li>
</ul>
</li>
</ul>
<h3 id="writable-interface">Writable Interface</h3>
<p>Writable is a serializable object which implements a simple, efficient, serialization protocol</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Writable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>All values must implement interface Writable</li>
<li>All keys must implement interface WritableComparable</li>
<li>context.write(WritableComparable, Writable)
<ul>
<li>You cannot use java primitives here!!</li>
</ul>
</li>
</ul>
<h3 id="stripes-implementation">Stripes Implementation</h3>
<ul>
<li>A stripe key-value pair a → {b:1,c:2,d:5,e:3,f:2}:
<ul>
<li>Key: the term a</li>
<li>Value:the stripe{b:1,c:2,d:5,e:3,f:2}
<ul>
<li>In Java, easy, use map (hashmap)</li>
<li>How to represent this stripe in MapReduce?</li>
</ul>
</li>
</ul>
</li>
<li>MapWritable: the wrapper of Java map in MapReduce
<ul>
<li>put(Writable key, Writable value)</li>
<li>get(Object key)</li>
<li>containsKey(Object key)</li>
<li>containsValue(Object value)</li>
<li>entrySet()  returns Set&lt;Map.Entry&lt;Writable,Writable&gt;&gt;, used for iteration</li>
</ul>
</li>
</ul>
<h3 id="pairs-implementation">Pairs Implementation</h3>
<ul>
<li>Key-value pair (a, b) → count
<ul>
<li>Value: count</li>
<li>Key: (a, b)
<ul>
<li>In Java, easy, implement a pair class</li>
<li>How to store the key in MapReduce?</li>
</ul>
</li>
</ul>
</li>
<li>You must customize your own key, which must implement interface WritableComparable!</li>
</ul>
<h1 id="design-pattern-3-order-inversion">Design Pattern 3: Order Inversion</h1>
<hr>
<h2 id="computing-relative-frequencies">Computing Relative Frequencies</h2>
<ul>
<li>“Relative” Co-occurrence matrix construction
<ul>
<li><strong>we take into consideration the fact that some words appear more frequently than others</strong>
<ul>
<li>Word wi may co-occur frequently with word wj simply because one of the two is very common</li>
</ul>
</li>
<li>We need to convert absolute counts to relative frequencies f(wj|wi)
<ul>
<li>What proportion of the time does wj appear in the context of wi?</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="12.png" alt=""></p>
<ul>
<li>N(·,·) is the number of times a co-occurring word pair is observed</li>
<li>The denominator is called the marginal</li>
</ul>
<h2 id="fwjwi-stripes">f(wj|wi): “Stripes”</h2>
<p>In the reducer, the counts of all words that co-occur with the conditioning variable (wi) are available in the associative array. Hence, the sum of all those counts gives the marginal.</p>
<p>a→ {b1:3,b2 :12,b3 :7,b4 :1,…}<br>
f(b1|a) = 3 / (3 + 12 + 7 + 1 + …)</p>
<p><strong>Problems:</strong><br>
Memory:所有的stripes的计算在内存中进行</p>
<h2 id="fwjwi-pairs">f(wj|wi): “Pairs”</h2>
<ul>
<li>The reducer receives the pair (wi, wj) and the count<br>
<strong>Problems:</strong><br>
It is not possible to compute f(wj|wi) ,cause the marginal(边缘) cannot be computed until you got all counts</li>
</ul>
<h3 id="solution-1">Solution 1</h3>
<p>Fortunately, as for the mapper, also the reducer can preserve state across multiple keys</p>
<ul>
<li>We can buffer in memory all the words that co-occur with wi and their counts</li>
<li>This is basically building the associative array in the stripes method</li>
</ul>
<p>We must define the sort order of the pair:</p>
<ul>
<li>the keys are first sorted by the left word, and then by the right word</li>
<li>we can detect if all pairs associated with the word we are conditioning on w(i) have been seen</li>
<li>At this point, we can use the in-memory buffer, compute the relative frequencies and emit</li>
</ul>
<p>There is a problem: ((a, b1), {1, 1, 1, …}) and ((a, b2), {1, 1, 1, …}) may be assigned to different reducers.<br>
So we must <strong>define an appropriate partitioner to make sure all pairs with the same left word are sent to the same reducer</strong>!</p>
<p>(The default partitioner is based on the hash value of the intermediate key, modulo the number of reducers)</p>
<!--这个方法在mapper传来的pairs没有被sort的时候，需要对其先按照(wi, * )的方式进行sort，然后才是(wi, wj)的sort，然而在sort的过程中（即sort(wi, )），我们遍历了所有(wi,)对，所以分母就知道了。（所有的一切都是在memory中进行）
这里还有个问题就是，reducer1可能索取了(wi, wj)，reducer2可能索取了(wi, wq)，这就会产生词频统计不正确的现象（因为分母错误了），所以我们需要自己设定**partitioner**来使一个reducer来请求(wi, * )的单词对。这里的partitioner是基于采用hash value的方式，因为hash值是具有身份鉴别功能，所以只需要(wi, * )中的wi的hash value相同，就会被同一个reducer fetch。
-->
<p><strong>Still suffer from the memory problem!</strong></p>
<h3 id="solution-2-order-inversion">Solution 2: <strong>Order Inversion</strong></h3>
<p>我们先将计算好的marginal先传给reducer（pair(wi, *), all_count），再将各个单词对及其出现次数(pair(wi, wu), count)传输给reducer进行词频计算（即 frequency_of_(wi, wu) = count/all_count）。</p>
<ul>
<li>The mapper:
<ul>
<li>additionally emits a “special” key of the form (wi, ∗)</li>
<li>The value associated to the special key is one, that represents the contribution of the word pair to the marginal</li>
<li>Using combiners, these partial marginal counts will be aggregated before being sent to the reducers</li>
</ul>
</li>
<li>The reducer:
<ul>
<li>We must make sure that the special key-value pairs are processed <strong>before</strong> any other key-value pairs where the left word is wi <strong>(define sort order)</strong></li>
<li>We also need to guarantee that <strong>all pairs associated with the same word are sent to the same reducer (use partitioner)</strong><br>
<img src="media/15236805444236.jpg" alt=""></li>
</ul>
</li>
</ul>
<ul>
<li>Memory requirements:
<ul>
<li>Minimal, because <strong>only the marginal (an integer) needs to be<br>
stored</strong></li>
<li>No buffering of individual co-occurring word</li>
<li>No scalability bottleneck</li>
</ul>
</li>
</ul>
<ul>
<li>Key ingredients for order inversion
<ul>
<li><strong>Emit a special key-value pair to capture the marginal</strong></li>
<li><strong>Control the sort order of the intermediate key, so that the special key-value pair is processed first</strong></li>
<li><strong>Define a custom partitioner for routing intermediate key-value pairs</strong></li>
</ul>
</li>
</ul>
<h2 id="how-to-implement-order-inversion-in-mapreduce">How to Implement Order Inversion in MapReduce?</h2>
<p>Implement a Custom partitioner</p>
<ul>
<li>You need to implement a “pair” class first as the key data type</li>
<li>A customized partitioner extends the Partitioner class</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">YourPatitioner</span> <span class="keyword">extends</span> <span class="title">Partitioner</span>&lt;<span class="title">Key</span>, <span class="title">Value</span>&gt;</span>&#123;</span><br></pre></td></tr></table></figure>
<ul>
<li>The key and value are the intermediate key and value produced by the map function</li>
<li>In the relevant frequencies computing problem</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstPatitioner</span> <span class="keyword">extends</span> <span class="title">Partitioner</span>&lt;<span class="title">StringPair</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</span><br></pre></td></tr></table></figure>
<ul>
<li>It overrides the getPartition function, which has three parameters</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(WritableComparable key, Writable value, <span class="keyword">int</span> numPartitions)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>The numPartitions is the number of reducers used in the MapReduce program and it is specified in the driver program (by default 1)</li>
<li>In the relevant frequencies computing problem</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(StringPair key, IntWritable value, <span class="keyword">int</span> numPartitions)</span></span>&#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (key.getFirst().hashCode() &amp; Integer.MAX_VALUE) % numPartitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2018/04/14/COMP9313-Week-4-MapReduce-III/" data-toggle="tooltip" data-placement="top" title="MapReduce III">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2018/03/18/COMP9318-Week-3/" data-toggle="tooltip" data-placement="top" title="Data Warehousing and OLAP II">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#design-pattern-1-in-mapper-combining"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Design Pattern 1: In-mapper Combining</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#importance-of-local-aggregation"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">Importance of Local Aggregation</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#example-1-wordcount"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">Example 1: WordCount</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-1"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">Version 1</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-2-in-mapper-combining"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">Version 2: in-mapper combining</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#example-2-computing-the-mean"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">Example 2: Computing the Mean</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-1"><span class="toc-nav-number">1.3.1.</span> <span class="toc-nav-text">Version 1</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-2"><span class="toc-nav-number">1.3.2.</span> <span class="toc-nav-text">Version 2</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-3"><span class="toc-nav-number">1.3.3.</span> <span class="toc-nav-text">Version 3</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#version-4-in-mapper-combining"><span class="toc-nav-number">1.3.4.</span> <span class="toc-nav-text">Version 4 : in-mapper combining</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#how-to-implement-in-mapper-combiner-in-mapreduce"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">How to Implement In-mapper Combiner in MapReduce?</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#summary"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">Summary</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#design-pattern-2-pairs-vs-stripes"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Design Pattern 2: Pairs vs Stripes</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#term-co-occurrence-matrix"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">Term co-occurrence matrix</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#pairs"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">Pairs</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#stripes"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">Stripes</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#pairs-vs-stripes"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">Pairs vs. Stripes</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#how-to-implement-pairs-and-stripes-in-mapreduce"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">How to Implement “Pairs” and “Stripes” in MapReduce?</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#writable-interface"><span class="toc-nav-number">2.5.1.</span> <span class="toc-nav-text">Writable Interface</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#stripes-implementation"><span class="toc-nav-number">2.5.2.</span> <span class="toc-nav-text">Stripes Implementation</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#pairs-implementation"><span class="toc-nav-number">2.5.3.</span> <span class="toc-nav-text">Pairs Implementation</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#design-pattern-3-order-inversion"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">Design Pattern 3: Order Inversion</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#computing-relative-frequencies"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">Computing Relative Frequencies</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#fwjwi-stripes"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">f(wj|wi): “Stripes”</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#fwjwi-pairs"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">f(wj|wi): “Pairs”</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#solution-1"><span class="toc-nav-number">3.3.1.</span> <span class="toc-nav-text">Solution 1</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#solution-2-order-inversion"><span class="toc-nav-number">3.3.2.</span> <span class="toc-nav-text">Solution 2: Order Inversion</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#how-to-implement-order-inversion-in-mapreduce"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">How to Implement Order Inversion in MapReduce?</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#COMP9313" title="COMP9313">COMP9313</a>
                        
                          <a class="tag" href="/tags/#Big Data" title="Big Data">Big Data</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "jingxuan-li";
    var disqus_identifier = "https://jingxuan.li/2018/03/20/COMP9313-Week-3-MapReduce-II/";
    var disqus_url = "https://jingxuan.li/2018/03/20/COMP9313-Week-3-MapReduce-II/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/jingxuan0">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/jaceyli">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/jingxuan-li-490a60152/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Jingxuan 2018 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                    | 
                    <span id="busuanzi_container_site_pv">
                     Total <span id="busuanzi_value_site_pv"></span> Hits
                    </span>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>

<!-- 不蒜子统计 -->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://jingxuan.li/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>


</body>

</html>
